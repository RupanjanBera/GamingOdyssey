<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" href="favicon.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forgot Password - Gaming Odyssey</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  
  <style>
    :root {
      --primary: #3B82F6; /* Bright Blue */
      --secondary: #8B5CF6; /* Purple */
      --accent: #D946EF; /* Magenta */
      --dark: #020617; /* Darkest Navy Blue */
      --light: #E2E8F0; /* Light Slate */
      --mid: #0F172A; /* Mid Navy */
      --border-color: rgba(100, 116, 139, 0.3);
      --primary-glow: rgba(59, 130, 246, 0.3);
      --secondary-glow: rgba(217, 70, 239, 0.3);
    }

    /* Base Body Styles */
    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--dark);
      color: var(--light);
      background: var(--dark);
      overflow: hidden;
    }
    
    .tech-font { font-family: 'Orbitron', sans-serif; }

    /* Background Effects Container */
    #background-effects {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        z-index: 0;
    }
    .glow-layer {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: 
        radial-gradient(circle at 10% 20%, var(--primary-glow) 0%, transparent 30%),
        radial-gradient(circle at 90% 80%, var(--secondary-glow) 0%, transparent 30%);
      animation: animate-glow 20s ease-in-out infinite;
      will-change: transform, opacity;
    }
    @keyframes animate-glow {
        0% { transform: rotate(0deg) scale(1.4); opacity: 0.6; }
        50% { transform: rotate(180deg) scale(1.5); opacity: 0.8; }
        100% { transform: rotate(360deg) scale(1.4); opacity: 0.6; }
    }
    #particle-canvas {
        position: absolute; top: 0; left: 0;
        width: 100%; height: 100%;
    }

    /* Main Content Wrapper */
    .form-wrapper {
        animation: fadeIn 1.2s ease-in-out forwards;
        position: relative;
        z-index: 1;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(30px) scale(0.98); }
        to { opacity: 1; transform: translateY(0) scale(1); }
    }

    /* Shimmer Effect for Brand Name */
    .shimmer-text {
        background: linear-gradient(90deg, #9ca3af, #fff, #9ca3af);
        background-size: 200% auto;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: shimmer 5s linear infinite;
    }
    @keyframes shimmer { to { background-position: -200% center; } }
    
    /* Form Container */
    .form-container {
      background: rgba(15, 23, 42, 0.6);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--border-color);
      border-radius: 1.5rem;
      box-shadow: 0 16px 40px rgba(0,0,0,0.6);
      position: relative;
      overflow: hidden;
    }
    .form-container::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      border-radius: 1.5rem; padding: 1px;
      background: linear-gradient(145deg, var(--primary), var(--accent));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude;
      pointer-events: none; opacity: 0.7;
    }

    /* Input Field Styling */
    .input-field {
      background: #0F172A; color: var(--light);
      border: 1px solid var(--border-color);
      border-radius: 0.75rem;
      padding: 1rem 1rem 1rem 3.25rem; width: 100%;
      transition: all 0.3s ease;
    }
    .input-field::placeholder { color: #64748B; }
    .input-field:focus {
      outline: none; border-color: var(--primary);
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
    }
    .input-field:focus ~ .input-icon {
      color: var(--primary);
      text-shadow: 0 0 10px var(--primary);
    }
    .input-group { position: relative; }
    .input-icon {
      position: absolute; left: 1rem; top: 50%;
      transform: translateY(-50%); color: #64748B;
      transition: color 0.3s ease, text-shadow 0.3s ease;
    }
    
    /* Submit Button */
    .submit-btn {
      background-image: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
      background-size: 200% auto; color: white;
      font-weight: 600; padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      transition: all 0.4s ease-out;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      border: none; cursor: pointer;
      display: flex; align-items: center; justify-content: center; gap: 0.75rem;
    }
    .submit-btn:hover:not(:disabled) {
      background-position: right center;
      box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
      transform: translateY(-4px);
    }
    .submit-btn .btn-loader {
        width: 20px; height: 20px;
        border: 2px solid #fff; border-bottom-color: transparent;
        border-radius: 50%; display: none;
        animation: rotation 1s linear infinite;
    }
    .submit-btn.loading .btn-text, .submit-btn.loading .fas { display: none; }
    .submit-btn.loading .btn-loader { display: block; }
    .submit-btn:disabled {
        cursor: not-allowed; opacity: 0.8;
        background-image: linear-gradient(90deg, #64748B, #94A3B8);
        transform: translateY(0);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }
    @keyframes rotation { 100% { transform: rotate(360deg); } }

    /* Status Messages */
    .status-message {
      padding: 0.75rem 1rem; border-radius: 0.5rem;
      font-size: 0.9rem; font-weight: 500;
      margin-top: 1rem; opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    .status-message.visible { opacity: 1; transform: translateY(0); }
    .status-message.success {
      background-color: rgba(74, 222, 128, 0.1); color: #4ADE80;
      border: 1px solid rgba(74, 222, 128, 0.2);
    }
    .status-message.error {
      background-color: rgba(248, 113, 113, 0.1); color: #F87171;
      border: 1px solid rgba(248, 113, 113, 0.2);
    }
    
    /* Gemini Help Assistant Modal */
    #help-modal {
        z-index: 100;
        transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
    }
    #help-modal-content {
        transform: scale(0.95);
        transition: transform 0.3s ease-in-out;
    }
    #help-modal.visible {
        opacity: 1; visibility: visible;
    }
    #help-modal.visible #help-modal-content {
        transform: scale(1);
    }
    .chat-bubble {
        padding: 0.75rem 1rem; border-radius: 1rem; max-width: 80%;
    }
    .chat-bubble.user {
        background-color: var(--primary); color: white;
        border-bottom-right-radius: 0.25rem;
    }
    .chat-bubble.assistant {
        background-color: #1E293B; color: var(--light);
        border-bottom-left-radius: 0.25rem;
    }
    .chat-bubble.assistant.thinking span {
        display: inline-block;
        background-color: #475569;
        width: 8px; height: 8px; border-radius: 100%;
        margin: 0 2px;
        animation: bob 1.4s infinite ease-in-out both;
    }
    .chat-bubble.assistant.thinking span:nth-child(1) { animation-delay: -0.32s; }
    .chat-bubble.assistant.thinking span:nth-child(2) { animation-delay: -0.16s; }
    @keyframes bob {
        0%, 80%, 100% { transform: scale(0); }
        40% { transform: scale(1.0); }
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
  
  <div id="background-effects">
    <div class="glow-layer"></div>
    <canvas id="particle-canvas"></canvas>
  </div>
  
  <main class="w-full max-w-md form-wrapper">
    <div class="flex justify-center items-center mb-8 space-x-4">
      <img src="favicon.png" alt="Logo" class="w-12 h-12 drop-shadow-[0_0_15px_rgba(255,255,255,0.2)]">
      <h1 class="text-3xl font-black text-white tech-font shimmer-text">Gaming Odyssey</h1>
    </div>

    <div class="form-container p-8 md:p-10">
      <div class="text-center mb-8">
        <h2 class="text-3xl md:text-4xl font-bold tech-font text-white">Reset Password</h2>
        <p class="text-slate-400 mt-3">No worries, we'll send you reset instructions.</p>
      </div>

      <form id="reset-form" class="space-y-6">
        <div class="input-group">
          <i class="fas fa-envelope input-icon"></i>
          <input type="email" id="email" name="email" required placeholder="Enter your email" class="input-field" />
        </div>
        
        <div class="pt-2">
          <button type="submit" class="submit-btn w-full">
            <span class="btn-text">Send Reset Link</span>
            <div class="btn-loader"></div>
            <i class="fas fa-paper-plane"></i>
          </button>
          <div id="form-status" class="status-message"></div>
        </div>
        
        <div class="text-center text-slate-400 text-sm pt-4">
          Remembered your password? <a href="login.html" class="text-[var(--primary)] hover:underline font-semibold">Log In</a>
        </div>
      </form>
      
      <!-- Gemini Help Assistant Button -->
      <div id="help-button-container" class="text-center pt-6 transition-opacity duration-500">
          <button id="open-help-modal" class="text-sm text-slate-400 hover:text-white transition">
              ✨ Need Help? Chat with our Assistant
          </button>
      </div>
    </div>
  </main>
  
  <!-- Gemini Help Assistant Modal -->
  <div id="help-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 opacity-0 invisible">
      <div id="help-modal-content" class="form-container w-full max-w-lg">
          <div class="p-6">
              <div class="flex justify-between items-center mb-4">
                  <h3 class="text-xl tech-font">✨ Help Assistant</h3>
                  <button id="close-help-modal" class="text-slate-400 hover:text-white">&times;</button>
              </div>
              <div id="chat-window" class="h-64 overflow-y-auto space-y-4 p-4 bg-black/20 rounded-lg mb-4">
                  <!-- Chat messages will be appended here -->
              </div>
              <form id="chat-form" class="flex gap-2">
                  <input id="chat-input" type="text" placeholder="Ask a question..." class="input-field !p-3 flex-1" autocomplete="off">
                  <button type="submit" class="submit-btn !p-3 !rounded-lg aspect-square">
                      <i class="fas fa-paper-plane"></i>
                  </button>
              </form>
          </div>
      </div>
  </div>
  
  <script>
    // --- Firebase Configuration ---
    const firebaseConfig = {
      apiKey:"AIzaSyDA218WauVZNgqeMgiR_5H6TLYQB5HXZkY",
      authDomain: "gamingodyssey-2e642.firebaseapp.com",
      databaseURL: "https://gamingodyssey-2e642-default-rtdb.firebaseio.com",
      projectId: "gamingodyssey-2e642",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // --- UI Enhancements Script (Particles) ---
    // (This section is unchanged and remains as it was)
    const canvas = document.getElementById('particle-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let particlesArray;

    class Particle {
        constructor(x, y, directionX, directionY, size, color) {
            this.x = x; this.y = y; this.directionX = directionX;
            this.directionY = directionY; this.size = size; this.color = color;
        }
        draw() {
            ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2, false);
            ctx.fillStyle = this.color; ctx.fill();
        }
        update() {
            if (this.x > canvas.width || this.x < 0) this.directionX = -this.directionX;
            if (this.y > canvas.height || this.y < 0) this.directionY = -this.directionY;
            this.x += this.directionX; this.y += this.directionY;
            this.draw();
        }
    }
    function initParticles() {
        particlesArray = [];
        let numberOfParticles = (canvas.height * canvas.width) / 9000;
        for (let i = 0; i < numberOfParticles; i++) {
            let size = (Math.random() * 2) + 1;
            let x = (Math.random() * ((innerWidth - size * 2) - (size * 2)) + size * 2);
            let y = (Math.random() * ((innerHeight - size * 2) - (size * 2)) + size * 2);
            let directionX = (Math.random() * 0.4) - 0.2;
            let directionY = (Math.random() * 0.4) - 0.2;
            let color = 'rgba(100, 116, 139, 0.4)';
            particlesArray.push(new Particle(x, y, directionX, directionY, size, color));
        }
    }
    function animateParticles() {
        requestAnimationFrame(animateParticles);
        ctx.clearRect(0, 0, innerWidth, innerHeight);
        for (let i = 0; i < particlesArray.length; i++) {
            particlesArray[i].update();
        }
    }
    initParticles();
    animateParticles();
    window.addEventListener('resize', () => {
        canvas.width = innerWidth; canvas.height = innerHeight;
        initParticles();
    });

    // --- Form Submission Logic ---
    const form = document.getElementById('reset-form');
    const emailInput = document.getElementById('email');
    const submitBtn = form.querySelector('.submit-btn');
    const btnText = submitBtn.querySelector('.btn-text');
    const statusEl = document.getElementById('form-status');

    form.addEventListener('submit', function(event) {
        event.preventDefault();
        const email = emailInput.value.trim();
        
        submitBtn.classList.add('loading');
        submitBtn.disabled = true;
        statusEl.className = 'status-message'; 
        
        setTimeout(() => {
            auth.sendPasswordResetEmail(email)
              .then(() => {
                statusEl.textContent = 'Password reset email sent! Please check your inbox.';
                statusEl.className = 'status-message success visible';
                btnText.textContent = 'Email Sent!';
                emailInput.disabled = true;
                submitBtn.classList.remove('loading');
              })
              .catch((error) => {
                let errorMessage = 'An error occurred. Please try again.';
                if (error.code === 'auth/user-not-found') {
                    statusEl.textContent = 'If an account exists, a reset link has been sent.';
                    statusEl.className = 'status-message success visible';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Please enter a valid email address.';
                    statusEl.textContent = errorMessage;
                    statusEl.className = 'status-message error visible';
                } else {
                     statusEl.textContent = errorMessage;
                     statusEl.className = 'status-message error visible';
                }
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
              });
        }, 1000);
    });

    // --- Gemini Help Assistant Logic ---
    const helpModal = document.getElementById('help-modal');
    const openHelpModalBtn = document.getElementById('open-help-modal');
    const closeHelpModalBtn = document.getElementById('close-help-modal');
    const chatWindow = document.getElementById('chat-window');
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');
    
    let conversationHistory = [];

    const systemPrompt = `You are a friendly and helpful support assistant for 'Gaming Odyssey', a gaming website. Your name is 'Glitch'. A user is having trouble with the password reset process. Your goal is to provide clear, simple troubleshooting steps. Do not ask for any personal information like email or password. Be concise and use markdown for formatting if needed. If you cannot solve the problem, guide the user to contact official support at \`support@gamingodyssey.com\`. Start your first message with a friendly greeting and ask how you can help.`;

    async function callGeminiAPI(userMessage) {
        const apiKey = ""; // API key will be provided by the environment.
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        const payload = {
            contents: [...conversationHistory, { role: "user", parts: [{ text: userMessage }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };
        
        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                throw new Error(`API request failed with status ${response.status}`);
            }
            const result = await response.json();
            const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
            if (text) {
                return text;
            } else {
                return "I'm sorry, I encountered an issue. Please try again or contact support.";
            }
        } catch (error) {
            console.error("Gemini API Error:", error);
            return "I'm having trouble connecting right now. Please check your connection or contact support directly.";
        }
    }

    function addMessageToChat(text, sender) {
        const messageElement = document.createElement('div');
        messageElement.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
        
        const bubble = document.createElement('div');
        bubble.className = `chat-bubble ${sender}`;
        
        if (sender === 'assistant' && text === '...') {
            bubble.classList.add('thinking');
            bubble.innerHTML = '<span></span><span></span><span></span>';
        } else {
            bubble.textContent = text;
        }

        messageElement.appendChild(bubble);
        chatWindow.appendChild(messageElement);
        chatWindow.scrollTop = chatWindow.scrollHeight;
        return messageElement;
    }

    async function handleChatSubmit(e) {
        e.preventDefault();
        const userMessage = chatInput.value.trim();
        if (!userMessage) return;

        addMessageToChat(userMessage, 'user');
        conversationHistory.push({ role: "user", parts: [{ text: userMessage }] });
        chatInput.value = '';

        const thinkingBubble = addMessageToChat('...', 'assistant');
        
        const assistantResponse = await callGeminiAPI(userMessage);
        
        thinkingBubble.remove();
        addMessageToChat(assistantResponse, 'assistant');
        conversationHistory.push({ role: "model", parts: [{ text: assistantResponse }] });
    }

    openHelpModalBtn.addEventListener('click', () => {
        helpModal.classList.add('visible');
        if (conversationHistory.length === 0) {
            // Initial greeting from assistant
            const greeting = "Hi there! I'm Glitch, your friendly support assistant. How can I help you with your password reset today?";
            addMessageToChat(greeting, 'assistant');
            conversationHistory.push({ role: "model", parts: [{ text: greeting }] });
        }
    });
    
    closeHelpModalBtn.addEventListener('click', () => {
        helpModal.classList.remove('visible');
    });

    chatForm.addEventListener('submit', handleChatSubmit);

  </script>

</body>
</html>
